{% extends 'header.html' %}

{% block title %}Create Event – Redlight{% endblock %}

{% block content %}
<head>
    <title>Events – Redlight</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
</head>
<body>
    <form method="GET" class="row mb-4">
        <div class="col-md-3">
            <select name="sport" class="form-select">
                <option value="">All Sports</option>
                {% for sport in sport_types %}
                    <option value="{{ sport }}" {% if request.args.get('sport') == sport %}selected{% endif %}>{{ sport }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" name="date" class="form-control" value="{{ request.args.get('date', '') }}">
        </div>
       <div class="col-md-3">
            <a href="{{ url_for('events.list_events') }}" class="btn btn-outline-light">Clear Filters</a>
        </div>
    </form>

    <div class="mb-4 d-flex justify-content-between align-items-center">
        <h2>All Events</h2>
        <a href="{{ url_for('events.create_event') }}" class="btn redlight-btn">+ Create Event</a>
    </div>

    {% if events %}
        <ul class="list-group">
            {% for event in events %}
                <li class="list-group-item event-item {% if event.is_full %}full-event{% endif %}" 
                    data-tooltip="{% if event.user_signed_up %}You're already signed up{% else %}You're not signed up yet{% endif %}">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('events.event_detail', event_id=event.id) }}" 
                            class="text-decoration-none {% if event.is_full %}text-danger{% endif %}">
                            <strong>{{ event.title }}</strong> – {{ event.sport_type }} @ {{ event.location }} on {{ event.datetime }}
                        </a>
                        <span>{{ event.participants|length }}/{{ event.max_participants }}</span>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No events yet.</p>
    {% endif %}
</body>

<script>
document.querySelectorAll('select[name="sport"], input[name="date"]').forEach(el => {
    el.addEventListener('change', () => {
        el.form.submit();
    });
});
</script>

{% endblock %}
